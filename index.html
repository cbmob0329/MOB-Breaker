<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>MOBYOKI Arena</title>
<style>
  html,body{margin:0;padding:0;background:#0b1020;color:#d7e2ff;font-family:system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif;}
  .wrap{display:flex;flex-direction:column;align-items:center;gap:10px;padding:10px;}
  .titlescreen{max-width:980px;width:100%;background:#0e1630;border:1px solid #1f2a4d;border-radius:16px;padding:16px;box-shadow:0 8px 20px rgba(0,0,0,.35)}
  .titlescreen h1{margin:0 0 8px;font-size:20px}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  fieldset{border:1px solid #2a3a68;border-radius:12px}
  legend{padding:0 6px;color:#9fb6ff}
  .row{display:flex;align-items:center;gap:8px;padding:6px 10px}
  .row label{min-width:140px}
  input[type="number"]{width:72px;background:#0b1230;color:#d7e2ff;border:1px solid #26335c;border-radius:8px;padding:4px 6px}
  .actions{display:flex;gap:12px;justify-content:flex-end;padding:10px}
  button{background:#2b63ff;border:none;color:#fff;border-radius:12px;padding:10px 16px;cursor:pointer;font-weight:600}
  button.secondary{background:#20305a}
  .note{font-size:12px;color:#9fb6ff;margin-top:6px}

  /* ゲーム領域 */
  .gamewrap{display:none;flex-direction:column;align-items:center;gap:8px}
  canvas{width:100%;max-width:980px;aspect-ratio:16/9;background:#0a0f18;border:1px solid #1b2748;border-radius:12px}
  .hud{display:none;align-items:center;justify-content:space-between;gap:10px;width:100%;max-width:980px}
  .hp{position:relative;flex:1;height:16px;background:#101a35;border:1px solid #22315e;border-radius:999px;overflow:hidden}
  .hp i{position:absolute;left:0;top:0;bottom:0;width:100%;background:linear-gradient(90deg,#35ffb1,#36a8ff)}
  .hpnum{min-width:72px;text-align:right}
  .timer{min-width:64px;text-align:center;background:#111c3b;border:1px solid #233364;border-radius:8px;padding:3px 8px}

  .controls{display:flex;gap:10px;align-items:center;justify-content:space-between;width:100%;max-width:980px}
  /* 左: スティック */
  #stickArea{position:relative;width:180px;height:110px;background:#0e1630;border:1px solid #1e2a50;border-radius:12px;touch-action:none}
  #stickThumb{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:44px;height:44px;background:#2b63ff55;border:2px solid #2b63ff;border-radius:50%}
  /* 右: ボタン群 */
  .btns{display:grid;grid-template-columns:repeat(3,minmax(80px,1fr));gap:10px;flex:1}
  .btns button{padding:10px;border-radius:12px;background:#1b2852;border:1px solid #2d3e7a}
  .btns button:disabled{opacity:.45}
  .overhead{position:absolute;display:none;flex-direction:column;align-items:center;gap:2px;pointer-events:none}
  .overhead .gauge{width:110px;height:6px;background:#0f1a37;border:1px solid #243362;border-radius:999px;overflow:hidden}
  .overhead .gauge i{display:block;height:100%;width:0;background:linear-gradient(90deg,#ffd43b,#ff6b6b)}
</style>
</head>
<body>
<div class="wrap">

  <!-- タイトル＆選択 -->
  <div class="titlescreen" id="titleScreen">
    <h1>敵/味方の編成を選んでスタート</h1>
    <div class="grid">
      <fieldset>
        <legend>敵を選択（種類と数）</legend>
        <div class="row"><label>WaruMOB（雑魚）</label><input type="number" min="0" max="30" step="1" value="5" data-team="enemy" data-key="WaruMOB"></div>
        <div class="row"><label>IceRoboMini（小型）</label><input type="number" min="0" max="30" step="1" value="0" data-team="enemy" data-key="IceRoboMini"></div>
        <div class="row"><label>Kozou（投石）</label><input type="number" min="0" max="30" step="1" value="0" data-team="enemy" data-key="Kozou"></div>
        <div class="row"><label>GabuKing</label><input type="number" min="0" max="10" step="1" value="0" data-team="enemy" data-key="GabuKing"></div>
        <div class="row"><label>Screw</label><input type="number" min="0" max="10" step="1" value="0" data-team="enemy" data-key="Screw"></div>
        <div class="row"><label>IceRobo</label><input type="number" min="0" max="10" step="1" value="0" data-team="enemy" data-key="IceRobo"></div>
        <div class="row"><label>MOBGiant（巨神）</label><input type="number" min="0" max="10" step="1" value="0" data-team="enemy" data-key="MOBGiant"></div>
        <div class="row"><label>MOBYOKI（CPU敵）</label><input type="number" min="0" max="10" step="1" value="0" data-team="enemy" data-key="MobyCPU"></div>
        <p class="note">※ 雑魚の爽快感を出すなら WaruMOB を 5 の倍数で入れるのがオススメ</p>
      </fieldset>

      <fieldset>
        <legend>味方を選択（MOBYOKIはプレイヤー固定）</legend>
        <div class="row"><label>MOBYOKI（味方CPU）</label><input type="number" min="0" max="10" step="1" value="0" data-team="ally" data-key="MobyCPU"></div>
        <div class="row"><label>WaruMOB（味方雑魚）</label><input type="number" min="0" max="30" step="1" value="0" data-team="ally" data-key="WaruMOB"></div>
        <div class="row"><label>IceRoboMini（小型）</label><input type="number" min="0" max="30" step="1" value="0" data-team="ally" data-key="IceRoboMini"></div>
        <div class="row"><label>GabuKing</label><input type="number" min="0" max="6" step="1" value="0" data-team="ally" data-key="GabuKing"></div>
        <div class="row"><label>Screw</label><input type="number" min="0" max="6" step="1" value="0" data-team="ally" data-key="Screw"></div>
        <div class="row"><label>IceRobo</label><input type="number" min="0" max="6" step="1" value="0" data-team="ally" data-key="IceRobo"></div>
      </fieldset>
    </div>
    <div class="actions">
      <button class="secondary" id="quick5">敵WaruMOB×10 で始める</button>
      <button id="startBtn">スタート</button>
    </div>
    <p class="note">スタート後は [←→ / A D] で移動、[Space/W/↑] ジャンプ、[J] 通常、[K] 強、[L] スキル（長押し可）、[O] 地割れ、[U] ULT（長押し可）</p>
  </div>

  <!-- HUD -->
  <div class="hud" id="hud">
    <div class="hp"><i id="hpfill" style="width:100%"></i></div>
    <div class="hpnum"><span id="hpnum">1000</span> HP</div>
    <div class="timer" id="time">00:00</div>
  </div>

  <!-- ゲーム本体 -->
  <div class="gamewrap" id="gameWrap">
    <canvas id="game" width="1280" height="720"></canvas>
    <div class="controls">
      <div id="stickArea"><div id="stickThumb"></div></div>
      <div class="btns">
        <button id="btnA1">A1 通常</button>
        <button id="btnA2">A2 強</button>
        <button id="btnJMP">ジャンプ</button>
        <button id="btnSK">スキル</button>
        <button id="btnSK2">地割れ</button>
        <button id="btnULT">ULT</button>
      </div>
    </div>
  </div>
</div>

<!-- あなたの script.js を読み込み -->
<script src="./script.js"></script>

<!-- タイトル画面→ゲーム開始 の起動コード -->
<script>
(function(){
  const $ = (sel)=>document.querySelector(sel);
  const $$ = (sel)=>Array.from(document.querySelectorAll(sel));

  function readConfig(){
    const enemies={}, allies={};
    $$('#titleScreen input[type="number"]').forEach(input=>{
      const n = parseInt(input.value,10) || 0;
      if(n<=0) return;
      const team = input.dataset.team;
      const key  = input.dataset.key;
      (team==='enemy'? enemies : allies)[key] = n;
    });
    return { enemies, allies };
  }

  function startWithConfig(cfg){
    // 画面切り替え
    $('#titleScreen').style.display='none';
    $('#hud').style.display='flex';
    $('#gameWrap').style.display='flex';

    // ゲーム開始（script.js が公開しているフック）
    if(typeof window.__startGameWithConfig === 'function'){
      window.__startGameWithConfig(cfg);
    }else{
      alert('ゲーム初期化関数が見つかりませんでした（script.jsの読み込み順を確認してください）');
    }
  }

  $('#startBtn').addEventListener('click', ()=>{
    const cfg = readConfig();
    startWithConfig(cfg);
  });

  // ワンクリック・クイックスタート
  $('#quick5').addEventListener('click', ()=>{
    const enemies = { WaruMOB: 10 }; // 爽快さ重視（小型を10体）
    const allies  = {};
    startWithConfig({enemies, allies});
  });

})();
</script>
</body>
</html>
